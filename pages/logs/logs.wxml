<view class="container">
  <view class="search-toggle" bindtap="toggleSearch">
    <text class="toggle-icon">{{searchExpanded ? 'â–¼' : 'â–¶'}}</text>
    <text class="toggle-text">{{searchExpanded ? 'æ”¶èµ·æœç´¢' : 'å±•å¼€æœç´¢'}}</text>
  </view>

  <view wx:if="{{searchExpanded}}" class="search-section">
    <view class="search-item">
      <view class="search-label">å‘¼å·</view>
      <input 
        class="search-input" 
        value="{{searchCallSign}}" 
        bindinput="onSearchCallSign"
        placeholder="è¾“å…¥å‘¼å·æœç´¢"
      />
    </view>
    <view class="search-item">
      <view class="search-label">æ—¥æœŸèŒƒå›´</view>
      <view class="date-range">
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="date-picker">{{startDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
        </picker>
        <text class="date-separator">è‡³</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="date-picker">{{endDate || 'ç»“æŸæ—¥æœŸ'}}</view>
        </picker>
      </view>
    </view>
    <view class="search-actions">
      <button class="search-btn" bindtap="handleSearch">æœç´¢</button>
      <button class="reset-btn" bindtap="handleReset">é‡ç½®</button>
    </view>
  </view>

  <view wx:if="{{filteredLogs.length > 0}}" class="log-list">
    <view 
      wx:for="{{filteredLogs}}" 
      wx:key="id" 
      class="log-item"
      bindtap="viewLogDetail"
      data-id="{{item.id}}"
    >
      <view class="log-header">
        <view class="log-callsign">{{item.callSign}}</view>
        <view class="log-date">{{item.date}} {{item.btcTime}} BJT</view>
      </view>
      <view class="log-detail">
        <!-- 1. é¢‘ç‡ -->
        <view wx:if="{{item.frequency}}" class="log-detail-item">
          <text>ğŸ“» {{item.frequency}} MHz</text>
        </view>
        <!-- 2. å¯¹æ–¹ä¿¡å·æŠ¥å‘Š -->
        <view wx:if="{{item.rst.theirRst || (item.rst && (item.rst.r || item.rst.s || item.rst.t))}}" class="log-detail-item">
          <text>RST: {{item.rst.theirRst ? (item.rst.theirRst.r || '-') + (item.rst.theirRst.s || '-') + (item.rst.theirRst.t ? item.rst.theirRst.t : '') : (item.rst.r || '-') + (item.rst.s || '-') + (item.rst.t ? item.rst.t : '')}}</text>
        </view>
        <!-- 3. å‘å°„åŠŸç‡ -->
        <view wx:if="{{item.power}}" class="log-detail-item">
          <text>âš¡ {{item.power}}W</text>
        </view>
        <!-- 4. å·¥ä½œæ¨¡å¼ -->
        <view wx:if="{{item.mode}}" class="log-detail-item">
          <text>ğŸ“¡ {{item.mode}}</text>
        </view>
        <!-- 5. åœ°å€ -->
        <view wx:if="{{item.qth}}" class="log-detail-item">
          <text>ğŸ“ {{item.qth}}</text>
        </view>
      </view>
      <view wx:if="{{item.weather}}" class="log-detail" style="margin-top: 10rpx;">
        <view class="log-detail-item">
          <text>{{getWeatherIcon(item.weather)}} {{getWeatherText(item.weather)}}</text>
        </view>
      </view>
    </view>
  </view>
  <view wx:else class="empty-tip">
    <text>{{searchCallSign || startDate || endDate ? 'æœªæ‰¾åˆ°åŒ¹é…çš„æ—¥å¿—' : 'æš‚æ— é€šè”æ—¥å¿—'}}</text>
    <text style="display: block; margin-top: 20rpx; font-size: 24rpx;">ç‚¹å‡»ä¸‹æ–¹"é€šè”"æ ‡ç­¾å¼€å§‹è®°å½•</text>
  </view>
</view>